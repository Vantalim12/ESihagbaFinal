<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>eSihagBa - City Budget Tracking System</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-brand">
          <i class="bi bi-buildings-fill"></i>
          <div>
            <span class="brand-title">eSihagBa</span>
            <div class="brand-subtitle">City Budget Tracking System</div>
          </div>
        </div>
        <div class="nav-menu" id="nav-menu">
          <a href="#dashboard" class="nav-link active" data-section="dashboard">
            <i class="bi bi-house-door"></i> Dashboard
          </a>
          <a href="#budget" class="nav-link" data-section="budget">
            <i class="bi bi-pie-chart"></i> Budget Analytics
          </a>
          <a href="#transactions" class="nav-link" data-section="transactions">
            <i class="bi bi-file-text"></i> Transactions
          </a>
          <a href="#audit-trail" class="nav-link" data-section="audit-trail">
            <i class="bi bi-journal-check"></i> Audit Trail
          </a>
          <a href="#events" class="nav-link" data-section="events">
            <i class="bi bi-calendar-event"></i> Event Management
          </a>
          <a href="#citizens" class="nav-link" data-section="citizens">
            <i class="bi bi-people"></i> Citizen Portal
          </a>
        </div>
        <div class="nav-actions">
          <button class="wallet-connect-btn" id="wallet-connect-btn">
            <i class="bi bi-wallet2"></i> Connect Wallet
          </button>
          <div class="nav-toggle" id="nav-toggle">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Connection Status -->
      <div class="connection-status" id="connection-status">
        <div class="status-indicator">
          <i class="fas fa-circle" id="status-icon"></i>
          <span id="status-text">Connecting to ICP...</span>
        </div>
        <div class="canister-info" id="canister-info"></div>
      </div>

      <!-- Dashboard Section -->
      <section id="dashboard" class="content-section active">
        <div class="section-header">
          <h1><i class="bi bi-house-door me-2"></i>Dashboard</h1>
          <p>Overview of Iligan City's budget and transaction activity</p>
        </div>

        <!-- Quick Stats Row -->
        <div class="stats-grid row g-4 mb-4">
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-cash-stack"></i>
              </div>
              <div class="stat-content">
                <h3 id="total-budget">₱2,500,000</h3>
                <p>Total Budget (2025)</p>
                <small class="text-success">+5% from last year</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-graph-up"></i>
              </div>
              <div class="stat-content">
                <h3 id="utilized-budget">₱1,250,000</h3>
                <p>Utilized Budget</p>
                <small class="text-info">50% utilization</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-building"></i>
              </div>
              <div class="stat-content">
                <h3 id="ongoing-projects">12</h3>
                <p>Ongoing Projects</p>
                <small class="text-warning">3 behind schedule</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-check-circle"></i>
              </div>
              <div class="stat-content">
                <h3 id="approved-transactions">248</h3>
                <p>Approved Transactions</p>
                <small class="text-success">15 this week</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="row g-4 mb-4">
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <h5><i class="bi bi-bar-chart me-2"></i>Budget Utilization</h5>
              </div>
              <div class="card-body">
                <canvas id="budgetUtilizationChart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5><i class="bi bi-pie-chart me-2"></i>Budget Allocation</h5>
              </div>
              <div class="card-body">
                <canvas id="budgetAllocationChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity Feed -->
        <div class="row g-4">
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <h5><i class="bi bi-activity me-2"></i>Recent Activity</h5>
              </div>
              <div class="card-body">
                <div class="activity-timeline" id="recent-activity">
                  <!-- Will be populated by JavaScript -->
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5>
                  <i class="bi bi-calendar-event me-2"></i>Upcoming Events
                </h5>
              </div>
              <div class="card-body">
                <div class="upcoming-events" id="upcoming-events">
                  <!-- Will be populated by JavaScript -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Budget Analytics Section -->
      <section id="budget" class="content-section">
        <div class="section-header">
          <h1><i class="bi bi-pie-chart me-2"></i>Budget Analytics</h1>
          <p>Comprehensive budget analysis and performance metrics</p>
        </div>

        <!-- Budget Overview Cards -->
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-calendar"></i>
              </div>
              <div class="stat-content">
                <h3>₱2,500,000</h3>
                <p>Annual Budget</p>
                <small class="text-success">2025 Allocation</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-graph-down"></i>
              </div>
              <div class="stat-content">
                <h3>₱625,000</h3>
                <p>Q1 Expenditure</p>
                <small class="text-info">25% of budget</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-graph-up"></i>
              </div>
              <div class="stat-content">
                <h3>₱625,000</h3>
                <p>Q2 Expenditure</p>
                <small class="text-info">25% of budget</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-piggy-bank"></i>
              </div>
              <div class="stat-content">
                <h3>₱1,250,000</h3>
                <p>Remaining Budget</p>
                <small class="text-success">50% available</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Charts -->
        <div class="row g-4">
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <h5>
                  <i class="bi bi-graph-up me-2"></i>Monthly Expenditure Trend
                </h5>
              </div>
              <div class="card-body">
                <canvas id="monthlyExpenditureChart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h5>
                  <i class="bi bi-bar-chart me-2"></i>Category Distribution
                </h5>
              </div>
              <div class="card-body">
                <canvas id="categoryDistributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Transactions Section -->
      <section id="transactions" class="content-section">
        <div class="section-header">
          <h1><i class="bi bi-file-text me-2"></i>Transactions</h1>
          <div class="section-actions">
            <button
              class="btn btn-success"
              onclick="openModal('record-transaction-modal')"
            >
              <i class="bi bi-plus"></i> Record Transaction
            </button>
          </div>
        </div>

        <!-- Transaction Filters -->
        <div class="filters">
          <select id="status-filter" class="filter-select">
            <option value="">All Statuses</option>
            <option value="Pending">Pending</option>
            <option value="Confirmed">Confirmed</option>
            <option value="Failed">Failed</option>
          </select>
          <input
            type="text"
            id="address-filter"
            placeholder="Filter by address..."
            class="filter-input"
          />
          <button class="btn btn-secondary" onclick="applyFilters()">
            Filter
          </button>
          <button class="btn btn-outline" onclick="clearFilters()">
            Clear
          </button>
        </div>

        <!-- Transactions List -->
        <div class="transactions-list" id="transactions-list">
          <!-- Will be populated by JavaScript -->
        </div>
      </section>

      <!-- Audit Trail Section -->
      <section id="audit-trail" class="content-section">
        <div class="section-header">
          <h1><i class="bi bi-journal-check me-2"></i>Audit Trail</h1>
          <p>System activity log with blockchain verification</p>
        </div>

        <!-- Advanced Search -->
        <div class="card mb-4">
          <div class="card-header">
            <h5><i class="bi bi-search me-2"></i>Advanced Search</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <select class="form-select" id="audit-action-filter">
                  <option value="">All Actions</option>
                  <option value="transaction">Transaction</option>
                  <option value="budget">Budget</option>
                  <option value="user">User Management</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="audit-user-filter">
                  <option value="">All Users</option>
                  <option value="admin">Admin</option>
                  <option value="user">User</option>
                  <option value="auditor">Auditor</option>
                </select>
              </div>
              <div class="col-md-3">
                <input type="date" class="form-control" id="audit-date-from" />
              </div>
              <div class="col-md-3">
                <input type="date" class="form-control" id="audit-date-to" />
              </div>
            </div>
          </div>
        </div>

        <!-- System Activity Log -->
        <div class="card">
          <div class="card-header">
            <h5><i class="bi bi-activity me-2"></i>System Activity Log</h5>
          </div>
          <div class="card-body">
            <div class="audit-timeline" id="audit-timeline">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </section>

      <!-- Events Section -->
      <section id="events" class="content-section">
        <div class="section-header">
          <h1><i class="bi bi-calendar-event me-2"></i>Event Management</h1>
          <p>Government event planning and budget allocation</p>
          <div class="section-actions">
            <button
              class="btn btn-success"
              onclick="openModal('create-event-modal')"
            >
              <i class="bi bi-plus"></i> Create Event
            </button>
          </div>
        </div>

        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          Event management features are under development. Coming soon: event
          creation, budget allocation, timeline management, and participant
          tracking.
        </div>
      </section>

      <!-- Citizens Portal Section -->
      <section id="citizens" class="content-section">
        <div class="section-header">
          <h1><i class="bi bi-people me-2"></i>Citizen Portal</h1>
          <p>Public transparency portal and document services</p>
        </div>

        <!-- Barangay Cards -->
        <div class="row g-4 mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5><i class="bi bi-geo-alt me-2"></i>Barangay VillaVerde</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-6">
                    <div class="text-center">
                      <h4 class="text-primary">₱500,000</h4>
                      <small>Allocated Budget</small>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-center">
                      <h4 class="text-success">₱250,000</h4>
                      <small>Utilized (50%)</small>
                    </div>
                  </div>
                </div>
                <div class="progress mt-3">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    style="width: 50%"
                  ></div>
                </div>
                <div class="mt-3">
                  <button class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-eye"></i> View Transactions
                  </button>
                  <button class="btn btn-outline-success btn-sm">
                    <i class="bi bi-shield-check"></i> Verify on Blockchain
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5>
                  <i class="bi bi-file-earmark-text me-2"></i>Certificate
                  Generation
                </h5>
              </div>
              <div class="card-body">
                <p>Generate official Barangay Clearance documents</p>
                <button
                  class="btn btn-primary"
                  onclick="openModal('certificate-modal')"
                >
                  <i class="bi bi-file-plus"></i> Generate Certificate
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Profile Section -->
      <section id="profile" class="content-section">
        <div class="section-header">
          <h1>Profile</h1>
          <p>Your account information and settings</p>
        </div>

        <div class="profile-grid">
          <div class="profile-card">
            <div class="profile-info" id="profile-info">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
          <div class="profile-card">
            <h3>Register Account</h3>
            <form id="register-form" class="form">
              <div class="form-group">
                <label>Role</label>
                <select id="role-select" required>
                  <option value="User">User</option>
                  <option value="Admin">Admin</option>
                  <option value="Auditor">Auditor</option>
                </select>
              </div>
              <div class="form-group">
                <label>Name</label>
                <input type="text" id="user-name" required />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="user-email" required />
              </div>
              <button type="submit" class="btn btn-primary">Register</button>
            </form>
          </div>
        </div>
      </section>
    </main>

    <!-- Modals -->
    <!-- Record Transaction Modal -->
    <div id="record-transaction-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Record New Transaction</h3>
          <button
            class="modal-close"
            onclick="closeModal('record-transaction-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="transaction-form" class="form">
          <div class="form-row">
            <div class="form-group">
              <label>From Address</label>
              <input type="text" id="from-address" required />
            </div>
            <div class="form-group">
              <label>To Address</label>
              <input type="text" id="to-address" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Amount</label>
              <input type="number" id="amount" step="0.00000001" required />
            </div>
            <div class="form-group">
              <label>Token Type</label>
              <select id="token-type" required>
                <option value="ICP">ICP</option>
                <option value="ICRC1">ICRC1</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Transaction Type</label>
              <select id="transaction-type" required>
                <option value="Transfer">Transfer</option>
                <option value="Mint">Mint</option>
                <option value="Burn">Burn</option>
                <option value="Swap">Swap</option>
                <option value="Stake">Stake</option>
                <option value="Unstake">Unstake</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Block Height (Optional)</label>
              <input type="number" id="block-height" />
            </div>
          </div>
          <div class="form-group">
            <label>Transaction Hash (Optional)</label>
            <input
              type="text"
              id="tx-hash"
              placeholder="Auto-generated if empty"
            />
          </div>
          <div class="form-group">
            <label>Memo (Optional)</label>
            <textarea id="memo" rows="3"></textarea>
          </div>
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-outline"
              onclick="closeModal('record-transaction-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Record Transaction
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Wallet Modal -->
    <div id="add-wallet-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add New Wallet</h3>
          <button class="modal-close" onclick="closeModal('add-wallet-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="wallet-form" class="form">
          <div class="form-group">
            <label>Wallet Address</label>
            <input type="text" id="wallet-address" required />
          </div>
          <div class="form-group">
            <label>Wallet Type</label>
            <select id="wallet-type" required>
              <option value="InternetIdentity">Internet Identity</option>
              <option value="Ledger">Ledger</option>
              <option value="Plug">Plug</option>
              <option value="Stoic">Stoic</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Label (Optional)</label>
            <input type="text" id="wallet-label" placeholder="My Wallet" />
          </div>
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-outline"
              onclick="closeModal('add-wallet-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Add Wallet</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Processing...</p>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@dfinity/agent@1.1.0/lib/umd/index.js"></script>
    <script src="https://unpkg.com/@dfinity/candid@1.1.0/lib/umd/index.js"></script>
    <script src="https://unpkg.com/@dfinity/principal@1.1.0/lib/umd/index.js"></script>
    <script src="app.js"></script>
  </body>
</html>
